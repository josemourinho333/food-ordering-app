<!DOCTYPE html>
<html lang="en">
  <%- include('partials/_head.ejs') %>
  <body>
    <%- include('partials/_header') %>
    <div class="content">
      <h1>My Account</h1>

      <% let count = 0;%>

      <% for (order of orders) { %>
        <% if ( order.status_sent == true ) { %>
          <% count++ %>
      <% }} %>


      <h5>Total number of Orders: <%= count %></h5>

      <!-- <div class="users"> -->
      <div class="user-page">
        <div id="user-info">
          <span class="user-line-info">My Contact</span>
          <span class="user-line-info"><%= user.name %>
          <% if (user.is_admin) { %>
            <i class="fa-solid fa-user-check" style="color:blue"></i>
            <%} else { %>
              <i class="fa-solid fa-user" style="color:green"></i>
              <% } %>
          </span>
          <span class="user-line-info"><%= user.phone_number.slice(2) %></span>
          <span class="user-line-info"><%= user.email %></span>
          <span class="user-line-info"><%= user.street_address %></span>
          <span class="user-line-info"><%= user.province %></span>
          <span class="user-line-info"><%= user.postal_code %></span>
          <span class="user-line-info"><%= user.country %></span>
          <button>Edit</button>

          <span></span>
        </div>


        <div id="order-info">
          <% for (order of orders) { %>

            <% if ( order.status_sent == true ) { %>
              <span class="order-line-info">

                <span class="line-detail-box">
                  <span class="field">Order ID:</span>
                  <%= order.id %>
                </span>

                <span class="line-detail-box">
                  <span class="field">Created on</span>
                  <% const dateStr = ''+order.time_sent %>
                  <% let orderDate = dateStr.slice(0,15)%>
                  <% let orderTime = dateStr.slice(16,21)%>
                  <%= orderDate %>, <%= orderTime %>
                </span>

                <%let status = 'Completed'; %>
                <%let ETA = ''+order.time_of_pickup; %>

                <% if(!order.status_finished) { status='Active'; %>
                <!--  ETA = order  -->
                <span class="line-detail-box stat-active">
                  <span class="field">Status:</span>
                  <%= status %>
                </span>
                <span class="line-end-box">
                  <span class="field">Ready By:</span>
                  <%= ETA.slice(16,21) %>
                </span>
                <% } else { %>


                <span class="line-detail-box stat-complete">
                  <span class="field">Status:</span>
                  <%= status %>
                </span>
                <% } %>


              </span>
            <% } %>

          <% } %>

        </div>
      </div>
      <div id="filler2">
      </div>

      <%- include('partials/_footer') %>

    </div>
  </body>
</html>
